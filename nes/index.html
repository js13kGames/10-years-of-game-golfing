<canvas id=fC width=256 height=240></canvas><p>Controls: arrows, X, C, Start, Esc<p><input type=file id=fileInput><script>var m,ir,E={lo:null,cy:0,m:0,mi:0,P:[],C:[],fc:null,vc:null,fd:null,vd:null,fb:null,vb:null,fb8:null,vb8:null,fb32:null,vb32:null,ch:0,ct:null,p0:0,p1:1,cb:0,mb:0,init:({rom:r,f:a,vram:t})=>{E.r(),E.p(r),E.load(),E.fc=a.getContext("2d"),E.fd=E.fc.getImageData(0,0,256,240),E.fb=new ArrayBuffer(245760),E.vb=new ArrayBuffer(983040),E.fb8=new Uint8Array(E.fb),E.fb32=new Uint32Array(E.fb),E.ct={1:new co},onkeydown=onkeyup=r=>{E[r.type](1,{37:bL,38:bU,39:bR,40:bD,88:bA,67:bB,27:bS,13:bT}[r.keyCode])}},play:()=>{E.lo=setInterval(E.f,1e3/60)},a1:()=>{clearInterval(E.lo)},r:()=>{E.a1(),a2(),a3(),ir=2,E.ch=0},f:()=>{var r;for(tC=0,ef=0;!ef;)for(0===E.ch?r=a4():E.ch-=Math.min(E.ch,8),i=r;i--;)a5()},keydown:(r,e)=>{E.ct[r].keydown(e)},keyup:(r,e)=>{E.ct[r].keyup(e)},a6:r=>{E.ch+=r},p:(r,e,a,t)=>{if(r[0]+r[1]+r[2]+r[3]==256){for(E.mi=8&r[6]?2:1&r[6]?0:1,E.m=(r[6]>>4)+(240&r[7]),t=16,4&r[6]&&(t+=512),E.P=[],e=0;e<r[4];e++)for(E.P[e]=[],a=0;a<16384;a++)E.P[e][a]=r[t++];for(E.C=[[]],e=0;e<r[5];e++)for(E.C[e]=[],a=0;a<8192;a++)E.C[e][a]=r[t++]}}},clk=0,a2=()=>{m=[]},a5=()=>{a7(),a7(),a7()},a4=()=>(ir?(op(ir),ir=0):op(),c);a8=r=>{if((r&=65535)<8192)r&=2047;else if(r<16384){if(8194==(r&=8199))return a9();if(8196==r)return a0();if(8199==r)return b1()}else if(r<16416){if(16405==r)return b2();if(16406==r)return b3()}else{if(r>=32768&&r<49152)return E.P[E.p0][r-32768];if(r>=49152)return E.P[E.p1][r-49152]}return m[r]||0},b4=(r,e)=>{(r&=65535)<8192?r&=2047:r<16384?8192==(r&=8199)?b5(e):8193==r?b6(e):8195==r?b7(e):8196==r?b8(e):8197==r?b9(e):8198==r?c1(e):8199==r&&c2(e):r<16404||(r<16416?16404==r?c3(e):16405==r||16406==r&&(0==(1&e)&&1==(1&c4)&&(c5=0),c4=e):r>=24576&&r<32768&&E.c6(r,e)),r<32768&&(m[r]=e)},E.load=()=>{E.m?alert(E.m):(E.p0=0,E.p1=E.P.length-1,E.cb=0)};var co=function(){this.state=new Array(8);for(var r=0;r<this.state.length;r++)this.state[r]=64};c5=0,bA=0,bB=1,bS=2,bT=3,bU=4,bD=5,bL=6,bR=7,co.prototype={keydown:function(r){this.state[r]=65},keyup:function(r){this.state[r]=64}},b3=function(){var r;switch(c5){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r=E.ct[1].state[c5];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:default:r=0;break;case 19:r=1}return c5++,24===c5&&(c5=0),r},A=X=Y=S=0,PC=32768,P=36,t=o=a=p=c=0,r=r=>(c++,a8(r)),w=(r,e)=>(c++,b4(r,e)),F=r=>(Z=(r&=255)<1,N=r>>7,r),f=r=>(C=1&r,Z=r>>1&1,I=r>>2&1,D=r>>3&1,B=r>>4&1,V=r>>6&1,N=r>>7),f(P=36),h=r=>(w(256+S--,r),S&=255),g=e=>r(256+(S=255&S+1)),O=[...Array(255)].map(((r,e)=>Function("c--,PC++;a=a+p-256*(p>>7),PC++;a=r(p+X&255)+256*r(p+X+1&255),PC++,c++;a=r(p)+256*r(p+1&255)+Y,c+=a-Y>>8<a>>8||o>>4==9,PC++;a=r(a)+X&255,PC++;a=r(a)+Y&255,PC++;a=p,PC++;a=p+256*r(PC+=2);t=p+256*r(PC+=2),c+=t>>8<t+Y>>8||o>>4==9,a=t+Y;t=p+256*r(PC+=2),c+=t>>8<t+X>>8||o>>4==9||(15&o)>13,a=t+X".split(";")["020666Z0Z77713Z444Z8Z999720666Z0Z77713Z444Z8Z999Z20666Z0Z77713Z444Z8Z999Z20666Z0Z77713Z444Z8Z999020666Z0Z77713Z445Z8Z998020666Z0Z77713Z445Z8Z998020666Z0Z77713Z444Z8Z999020666Z0Z77713Z444Z8Z999"[e-(e>>2)]]+";"+"S=X;p=r(a),C=X-p>=0,F(X-p);p=r(a),C=Y-p>=0,F(Y-p);p=r(a),C=p>>7,w(a,F(2*p)),c++;C=A>>7,A=F(2*A+(1&P));p=r(a),C=p>>7,w(a,F(2*p+(1&P))),c++;C=1&A,A=F(A>>1);p=r(a),C=1&p,w(a,F(p>>1)),c++;X=F(X-1);p=r(a),F(p&A),N=p>>7&1,V=p>>6&1;C=1&A,A=F((A>>1)+128*(1&P));w(a,F(r(a)+1)),c++;X=F(X+1);Y=F(Y-1);Y=F(Y+1);Y=F(r(a));p=r(a),C=1&p,w(a,F((p>>1)+128*(1&P))),c++;C=0;I=1;D=0;I=0;A=F(r(a));A=F(r(a)&A);p=r(a),C=A-p>=0,F(A-p);p=r(a),t=A+C-1-p,V=!!(128&(A^p))&&!!(128&(A^t)),C=t>=0,A=F(t);p=r(a),t=A+C+p,V=!(128&(A^p))&&!!(128&(A^t)),C=t>255,A=F(t);C&&(c+=1+(a>>8!=PC+1>>8),PC=a);N&&(c+=1+(a>>8!=PC+1>>8),PC=a);Z&&(c+=1+(a>>8!=PC+1>>8),PC=a);N||(c+=1+(a>>8!=PC+1>>8),PC=a);V&&(c+=1+(a>>8!=PC+1>>8),PC=a);Z||(c+=1+(a>>8!=PC+1>>8),PC=a);V||(c+=1+(a>>8!=PC+1>>8),PC=a);X=F(r(a));A=F(r(a)^A);w(a,F((r(a)-1)&255)),c++;C=A>>7,A=F(2*A);h(PC>>8),h(255&PC),PC=a-1,c++;C=1;D=1;V=0;A=F(r(a)|A);h(A);h(P|16);A=F(g()),c++;f(g()&239),c++;f(g()),PC=g()+256*g()-1,c++;C||(c+=1+(a>>8!=PC+1>>8),PC=a);op(3,1);Y=F(A);w(a,A);w(a,X);X=F(S);X=F(A);w(a,Y);A=F(Y);A=F(X);PC=g()+256*g(c+=2);PC=a-1;PC=r(a)+256*r(a+1-256*((a&255)==255))-1".split(";")["PI#PI#KIDPI#=I#PI#1IDPI#E6%)6%M6$)6%;6%E6%F6%E6%NB'NB'JB&ZB'@B'NB'4B'NB'Y90Y90L9*[90>90Y90290Y90VRSVRS-zXVRSORSVRSWR VRS/5A/5AQ5U/5A:5A/5AH5T/5A\"7C\"7C.7(\"7C?7C\"7C37C\"7C!8+!8+,8z!8+<8+!8+G8+!8+"[e-(e>>2)].charCodeAt()-32]))),op=(e,t)=>(c=0,o=r(PC),p=r(a=PC+1),e?(e>1||r(8192)>>7)&&(e<3||!I)&&(e-2?(h(PC>>8),h(255&PC),h(t?16|P:239&P)):S=S-3&255,I=1,PC=r(65528+2*e)+256*r(65528+2*e+1)):(o&&O[o](),PC++,PC&=65535),P=C+2*Z+4*I+8*D+16*B+32+64*V+128*N);var t,o,sc,dot,c7,OAM,c8,c9,d1,d2,d3,d4,d5,d6,d7,xxx,d8,d9,e1,e2,e3,e4,e5,e6,e7,e8,e9,f1,f2,f3,f4,f5,ef,f6="777812a0090470810a00a007024040050130531000000000bbbe70e32f08b0b50e02d04c0780900a0390880111000000ffffb3f95f8af7fb7f67f39f3bf1d84d49f5de0333000000ffffeafdcfcdfcfdcfbbfadfaefafebfacfbff9888000000".match(/.../g).map((r=>+("0xff"+r[0]+r[0]+r[1]+r[1]+r[2]+r[2]))),a3=()=>{c7=[],OAM=[],sc=dot=c9=d1=d2=d3=d4=d5=d6=d7=xxx=d8=d9=e2=e3=e4=e5=0,b5(0),b6(0)},f7=r=>((r&=16383)>16127?16144==(r&=16159)&&(r=16128):r>12287?r-=4096:r>8191&&(E.mi<3?r&=14335+1024*E.mi:3==E.mi&&(r&=9215)),r),f9=r=>r<8192?E.C[E.cb][r]:(16128==(65523&r)&&(r=16128),c7[f7(r)]||0),b5=r=>{e6=r>>7&1,e7=r>>5&1,e8=r>>4&1,e9=r>>3&1,f1=r>>2&1,d5=3&r},b6=r=>{f2=r>>4&1,f3=r>>3&1},a9=()=>(t=m[8194]=(e2<<5)+(e3<<6)+(e4<<7),e5=0,e4=0,t),b7=r=>{f4=r},a0=()=>OAM[f4],b8=r=>{OAM[f4]=r,f4++,f4%=256},b9=r=>{e5?(d6=r>>3,d4=7&r):(d7=r>>3,xxx=7&r),e5^=1},c1=r=>{e5?(f5+=r,c9=d4,d2=d6+=r>>5,d3=d7=31&r,d1=d5):(f5=r<<8,d4=r>>4&3,d5=r>>2&3,d6=(3&r)<<3),e5^=1},c2=r=>{f5<8192&&(E.C[E.cb][f5]=r),c7[f7(f5)]=r,f5+=f1?32:1},b1=()=>(f5<=16128?(t=e1,e1=f9(f5)):t=f9(f5),f5+=1===f1?32:1,t),c3=r=>{for(var e=f4;e<256;e++)OAM[e]=m[256*r+e];for(e=0;e<513;e++)a5();E.a6(513)},f8=r=>{var e,a,P,_,l;for(c8=[],a=~~(r/8),e=64;e--;)for(_=f9((P=8192+2048*(a>29)+1024*(e>31))+960+8*(a%30>>2)+(e%32>>2))>>4*(a%30>>1&1)+2*(e%32>>1&1)&3,r%=8,x=8;x--;)t=4096*e8+16*f9(P+a%30*32+e%32)+r,(l=2*(f9(t+8)>>7-x&1)+(f9(t)>>7-x&1))&&(c8[8*e+x]=f6[f9(16128+4*_+l)])},drawsc=r=>{var e,a,P,_,l,A;for(P=[],e=0;e<64;e++)if(r>=OAM[4*e]&&r<OAM[4*e]+(e7?16:8)){if(8==P.length){e2=1;break}P.push(e)}for(a=0;a<256;a++)for(f3&&(E.fb32[256*r+a]=c8[(a+d8)%512]||f6[f9(f7(16128))]),e=P.length-1;e>=0;e--)a>=OAM[4*P[e]+3]&&a<OAM[4*P[e]+3]+8&&(l=3&OAM[4*P[e]+2],t=4*P[e],o=OAM[t],_=4096*(e7?1&OAM[t+1]:e9)+16*(OAM[t+1]&255-e7)+(128&OAM[t+2]?7-r+o+8*((r<o+8&&e7)+e7):8+r-o-8*(r<o+8)),t=a-OAM[4*P[e]+3],o=64&OAM[4*P[e]+2]?t:7-t,(A=2*(f9(_+8)>>o&1)+(f9(_)>>o&1))&&(32&OAM[4*P[e]+2]&&c8[(a+d8)%512]&&f3||!f2||(E.fb32[256*r+a]=f6[c7[16144+4*l+A]]),0===P[e]&&!e3&&c8[(a+d8)%512]&&f2&&f3&&(e3=1)))},a7=()=>{++dot>340&&(dot=0,sc++,d3=d7,d1=(2&d1)+(1&d5),sc<240?(f8((sc+d9)%480),drawsc(sc),d8=256*(1&d1)+8*d3+xxx):240==sc?(e4=1,ir=1,E.fd.data.set(E.fb8),E.fc.putImageData(E.fd,0,0)):260==sc?e2=e3=e4=0:261==sc&&(sc=-1,ef=1,d9=240*((d1=(1&d1)+(2&d5))>>1)+8*(d2=d6)+(c9=d4)))};fileInput.onchange=r=>{(r=new FileReader).readAsArrayBuffer(fileInput.files[0]),r.onload=()=>{E.init({rom:new Uint8Array(r.result),f:fC}),E.play()}}</script>